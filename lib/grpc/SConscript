# -*- mode: python; -*-
import os
import subprocess

vpath = '#third_party/grpc'
libpath = '#build/lib'

env = DefaultEnvironment()

cmd = ('(cd ' + Dir(vpath).abspath + '; make; ')

# Copy the libraries to #build/lib and header files to #build/include
target_cmd = ('cd ' + Dir(libpath).abspath + '; ' +
                  'cp ' + Dir(vpath).abspath + '/libs/opt/libgrpc.a .; ' +
                  'cp ' + Dir(vpath).abspath + '/libs/opt/libgrpc++.a .; ' +
                  'cp ' + Dir(vpath).abspath + '/libs/opt/protobuf/*.a . -R)')

products = [ str(File('#build/lib/libgrpc.a')),
             str(File('#build/lib/libgrpc++.a')),
             str(File('#build/lib/libprotobuf.a')),
             str(File('#build/lib/libprotoc.a')) ]

libgrpc = env.Command(products, None, cmd + target_cmd)
